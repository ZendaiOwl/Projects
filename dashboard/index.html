<!DOCTYPE html>
<!--
  Material Design Lite
  Copyright 2015 Google Inc. All rights reserved.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      https://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License
-->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="A front-end template that helps you build fast, modern mobile web apps.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <title>Dockr Dashboard</title>

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="icon" sizes="192x192" href="images/android-desktop.png">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Material Design Lite">
    <link rel="apple-touch-icon-precomposed" href="images/ios-desktop.png">

    <!-- Tile icon for Win8 (144x144 + tile color) -->
    <meta name="msapplication-TileImage" content="images/touch/ms-touch-icon-144x144-precomposed.png">
    <meta name="msapplication-TileColor" content="#3372DF">

    <link rel="shortcut icon" href="images/favicon.png">

    <!-- SEO: If your mobile URL is different from the desktop URL, add a canonical link to the desktop page https://developers.google.com/webmasters/smartphone-sites/feature-phones -->
    <!--
    <link rel="canonical" href="http://www.example.com/">
    -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.cyan-light_blue.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
    <style>
    #view-source {
      position: fixed;
      display: block;
      right: 0;
      bottom: 0;
      margin-right: 40px;
      margin-bottom: 40px;
      z-index: 900;
    }
    </style>
  </head>
  <body>
    <!-- The drawer is always open in large screens. The header is always shown, even in small screens. 
                        hx-on:click="parse_images();"-->
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer
                mdl-layout--fixed-header">
      <header class="mdl-layout__header">
        <div class="mdl-layout__header-row">
          <div class="mdl-layout-spacer"></div>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--expandable
                      mdl-textfield--floating-label mdl-textfield--align-right">
            <label class="mdl-button mdl-js-button mdl-button--icon"
                  for="fixed-header-drawer-exp">
              <i class="material-icons">search</i>
            </label>
            <div class="mdl-textfield__expandable-holder">
              <input class="mdl-textfield__input" type="text" name="sample"
                    id="fixed-header-drawer-exp">
            </div>
          </div>
        </div>
      </header>
      <div class="mdl-layout__drawer">
        <span class="mdl-layout-title">Dashboard</span>
        <nav class="mdl-navigation">
          <a class="mdl-navigation__link" href="">One</a>
          <a class="mdl-navigation__link" href="">Two</a>
          <a class="mdl-navigation__link" href="">Three</a>
          <a class="mdl-navigation__link" href="">Four</a>
        </nav>
      </div>
      <script>
        async function get_images() {
            let response = await fetch('/list/images');
            let json = await response.json();
            let obj = [];
            json.forEach((img) => {
                var name_and_tag = get_image_name_and_tag(img);
                var struct = {
                    name: name_and_tag.name,
                    tag: name_and_tag.tag,
                    containers: img.Containers,
                    version: img.Labels.version
                };
                obj.push(struct);
            });
            return obj
        };
        function get_image_name(data) {
            let image_name = data.Names.toString().replace("docker.io/","");
            return image_name;
        };
        function get_image_name_and_tag(data) {
            let dtag = data.Names.toString().split(":");
            let dname = dtag[0].replace("docker.io/","");
            return {
              name: dname,
              tag: dtag[1]
            };
        };
        async function get_system_info() {
            let response = await fetch('/system/info');
            let json = await response.json();
            let str = json.Uptime.toString().split(" ");
            let time = (str[0] + " " + str[1]);
            return [{
                arch: json.Architecture,
                img: json.Images,
                ct: json.Containers,
                v: json.ServerVersion,
                up: time,
            }];
        };
      </script>
      <main class="mdl-layout__content">
        <div class="page-content">
          <div class="mdl-grid">
            <div class="mdl-cell mdl-cell--6-col mdl-cell--4-col-phone" x-data="{}">
              <table class="mdl-data-table mdl-js-data-table mdl-shadow--2dp">
                <thead>
                  <tr>
                    <th class="mdl-data-table__cell--non-numeric">Arch</th>
                    <th class="mdl-data-table__cell--non-numeric">Images</th>
                    <th class="mdl-data-table__cell--non-numeric">Containers</th>
                    <th class="mdl-data-table__cell--non-numeric">Version</th>
                    <th class="mdl-data-table__cell--non-numeric">Uptime</th>
                  </tr>
                </thead>
                <tbody>
                  <template x-for="system in await get_system_info();">
                  <tr>
                      <td style="text-align: center;" class="mdl-data-table__cell--non-numeric" 
                          x-text="system.arch"></td>
                      <td style="text-align: center;" class="mdl-data-table__cell--non-numeric" 
                          x-text="system.img"></td>
                      <td style="text-align: center;" class="mdl-data-table__cell--numeric" 
                          x-text="system.ct"></td>
                      <td style="text-align: center;" class="mdl-data-table__cell--numeric" 
                          x-text="system.v"></td>
                      <td class="mdl-data-table__cell--numeric" 
                          x-text="system.up"></td>
                  </tr>
                  </template>
                </tbody>
              </table>
            </div>
            <div class="mdl-cell mdl-cell--4-col mdl-cell--4-col-phone"></div>
            <div class="mdl-cell mdl-cell--4-col" x-data="{}">
              <!-- mdl-data-table--selectable -->
              <table class="mdl-data-table mdl-js-data-table mdl-shadow--2dp">
                <thead>
                  <tr>
                    <th class="mdl-data-table__cell--non-numeric">Name</th>
                    <th class="mdl-data-table__cell--non-numeric">Tag</th>
                    <th class="mdl-data-table__cell--non-numeric">Containers</th>
                    <th class="mdl-data-table__cell--non-numeric">Version</th>
                  </tr>
                </thead>
                <tbody>
                  <template x-for="image in await get_images();">
                  <tr>
                      <td style="text-align: center;" 
                          class="mdl-data-table__cell--non-numeric" 
                          x-text="image.name"></td>
                      <td style="text-align: center;" 
                          class="mdl-data-table__cell--non-numeric" 
                          x-text="image.tag"></td>
                      <td style="text-align: center;" 
                          class="mdl-data-table__cell--numeric" 
                          x-text="image.containers"></td>
                      <td style="text-align: center;" 
                          class="mdl-data-table__cell--numeric" 
                          x-text="image.version"></td>
                  </tr>
                  </template>
                </tbody>
              </table>
            </div>
            <div class="mdl-cell mdl-cell--4-col mdl-cell--4-col-phone"></div>
          </div>
        </div>
      </main>
    </div>
    <script src="material.min.js"></script>
    <script src="htmx.min.js"></script>
    <script src="alpine.js"></script>
    <script>
      function test(data) {
          console.log(data);
      };
      async function create_table_row(index, json_data) {
        let table_row = await create_element('tr');
        let name = await create_element('td');
        let containers = await create_element('td');
        let version = await create_element('td');
        name.innerHTML = json_data[index].Names;
        containers.innerHTML = json_data[index].Containers;
        version.innerHTML = json_data[index].Version;
        table_row.appendChild(name);
        table_row.appendChild(containers);
        table_row.appendChild(version);
        return table_row;
      };
      async function create_element(element) {
        return document.createElement(element);
      };
      async function parse_images() {
        let response = await fetch('/list/images');
        let json = await response.json();
        json.forEach(show_table);
      };
      
      async function show_json(element, index, array) {
        let list_div = document.getElementById('list');
        list_div.innerHTML = "";
        let list_element = document.createElement('ul');
        let name = document.createElement('li');
        let labels = document.createElement('li');
        name.innerHTML = array[index].Names;
        labels.innerHTML = JSON.stringify(array[index].Labels);
        list_element.appendChild(name);
        list_element.appendChild(labels);
        list_div.appendChild(list_element);
      };
      
      async function show_table(element, index, array) {
        let the_div = document.getElementById('list');
        let the_table = document.createElement('table');
        the_table.classList.add('mdl-data-table');
        the_table.classList.add('mdl-js-data-table');
        the_table.classList.add('mdl-data-table--selectable');
        the_table.classList.add('mdl-shadow--2dp');
        
        let table_head = document.createElement('thead');
        let table_body = document.createElement('tbody');
        let table_row = document.createElement('tr');
        
        let th_title_names = document.createElement('th');
        let th_title_containers = document.createElement('th');
        let th_title_version = document.createElement('th');
        
        let td_names = document.createElement('td');
        let td_containers = document.createElement('td');
        let td_labels = document.createElement('td');
        
        td_labels.classList.add('mdl-data-table__cell--non-numeric');
        
        table_head.appendChild(table_row);
        th_title_names.innerHTML = "Name";
        th_title_containers.innerHTML = "Containers";
        th_title_version.innerHTML = "Version";
        table_head.appendChild(th_title_names);
        table_head.appendChild(th_title_containers);
        table_head.appendChild(th_title_version);
        the_table.appendChild(table_head);
        
        the_div.innerHTML = "";
        the_table.border = '1';
        the_table.appendChild(table_body);
        table_body.appendChild(table_row);
        
        td_names.width = '75';
        td_containers.width = '75';
        td_labels.width = '75';
        
        td_names.innerHTML = array[index].Names.toString().replace("docker.io/","");
        td_containers.innerHTML = array[index].Containers;
        td_labels.innerHTML = array[index].Labels.version;
        table_row.appendChild(td_names);
        table_row.appendChild(td_containers);
        table_row.appendChild(td_labels);
        the_div.appendChild(the_table);
      };
      
      async function add_class(element_id, class_string) {
        document.getElementById(element_id).classList.add(class_string);
      };
      
      async function remove_class(element_id, class_string) {
        document.getElementById(element_id).classList.remove(class_string);
      };
      
      async function toggle_class(element_id, class_string) {
        document.getElementById(element_id).classList.toggle(class_string);
      };
    </script>
  </body>
</html>
